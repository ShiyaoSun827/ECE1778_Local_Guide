// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  user
  admin
  superadmin
}

//User：用户 + 角色 + 邮箱是否验证
model User {
  id            String  @id @default(cuid())
  email         String  @unique
  name          String?
  // 如果你有密码字段，就保留：
  // password      String
  emailVerified Boolean @default(false)
  image         String?
  role          String  @default("user")
  bio           String?  // 个人简介
  location      String?  // 用户所在地
  //  Better Auth / admin 插件用
  banned Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  accounts      Account[]
  sessions      Session[]
  verifications Verification[]
  favorites     FavoritePlace[]
  places        Place[]
  comments      Comment[]
}

//Session：登录 session（支持 logout）
model Session {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  token     String   @unique
  expiresAt DateTime

  ipAddress String?
  userAgent String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// Account：邮箱,密码账号
model Account {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  providerId            String // 用 "email"
  accountId             String // 用 邮箱
  accessToken           String?
  refreshToken          String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  idToken               String?

  //  Email+Password 模式下存密码哈希
  password String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([providerId, accountId])
}

//Verification：邮箱验证 / 重置密码验证码

model Verification {
  id         String   @id @default(cuid())
  identifier String // 比如 email
  value      String // 验证 token
  expiresAt  DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
}

//Local guide 的业务核心标

//Category：地点分类

model Category {
  id    String  @id @default(cuid())
  name  String
  slug  String  @unique // 比如 "cafe" / "park"
  color String? // 前端标签颜色
  icon  String? // 前端图标名

  places Place[]
}

//Place：Local Guide 的地点

model Place {
  id String @id @default(cuid())

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  title       String   // [修改意图] 用户的自定义标题 (例如: "我的秘密约会圣地")
  placeName   String?  // [新增字段] Google Maps 上的实际地点名 (例如: "CN Tower")
  description String?  // 帖子内容/备注
  address     String?  // 实际地址
  latitude    Float
  longitude   Float

  imageUri   String?
  isFavorite Boolean @default(false) // [注意] 这目前是“私有”的收藏状态

  categoryId String?
  category   Category? @relation(fields: [categoryId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  comments Comment[]
}

//Comment，地点下的评论日志
model Comment {
  id String @id @default(cuid())

  placeId String
  place   Place  @relation(fields: [placeId], references: [id], onDelete: Cascade)

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  content String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model FavoritePlace {
  id       String @id @default(cuid())
  userId   String
  user     User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  placeId   String
  placeData Json

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, placeId])
}